(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82152,59187,95356,e=>{"use strict";var t=e.i(43476);function i(e){return(0,t.jsx)("div",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:14,background:"white",...e.style},children:e.children})}function s(e){return(0,t.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,t.jsx)("div",{style:{fontSize:12,opacity:.75},children:e.label}),e.children]})}function r(e){return(0,t.jsxs)("div",{style:{padding:14,borderRadius:16,border:"1px dashed rgba(0,0,0,0.18)"},children:[(0,t.jsx)("div",{style:{fontWeight:700},children:e.title}),(0,t.jsx)("div",{style:{marginTop:6,opacity:.8},children:e.description})]})}e.s(["default",()=>i],82152),e.s(["default",()=>s],59187),e.s(["default",()=>r],95356)},53917,e=>{"use strict";var t=e.i(43476),i=e.i(71645);e.i(36180);var s=e.i(98925),r=e.i(82152),a=e.i(59187);function d(e){return(0,t.jsx)("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between",gap:12},children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{fontSize:16,fontWeight:700},children:e.title}),e.subtitle?(0,t.jsx)("div",{style:{marginTop:4,fontSize:12,opacity:.75},children:e.subtitle}):null]})})}var l=e.i(95356);function n(e){return(0,t.jsx)("div",{style:{height:e.height??12,borderRadius:10,background:"rgba(0,0,0,0.08)",animation:"pulse 1.2s ease-in-out infinite"}})}var o=e.i(29371),c=e.i(47392);function u(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${t}/${i}/${s} ${r}:${a}`}e.i(61978);var g=e.i(52831),h=e.i(96263);async function p(e){let t=(0,h.assertDateId)(e),i=(0,g.httpsCallable)(o.functions,"callGenerateDayDiary");return(await i({dateId:t})).data}function x(e){return e&&"function"==typeof e.toDate?e.toDate():null}function m(){let[e,g]=(0,i.useState)(""),[h,m]=(0,i.useState)((0,c.todayDateId)()),[y,j]=(0,i.useState)([]),[f,v]=(0,i.useState)(!0),[b,S]=(0,i.useState)(""),[w,T]=(0,i.useState)(null),[I,D]=(0,i.useState)([]),[$,A]=(0,i.useState)(!0),[z,C]=(0,i.useState)(""),[R,N]=(0,i.useState)(!1),[H,M]=(0,i.useState)("");(0,i.useEffect)(()=>{(0,o.ensureSignedIn)().then(g).catch(()=>g(""))},[]);let k=(0,i.useMemo)(()=>{try{return(0,c.normalizeDateId)(h)}catch{return""}},[h]);(0,i.useEffect)(()=>{if(!e||!k){j([]),v(!1);return}v(!0),S("");let t=(0,s.collection)(o.db,`users/${e}/fragments`),i=(0,s.query)(t,(0,s.where)("dateId","==",k),(0,s.orderBy)("createdAt","asc")),r=(0,s.onSnapshot)(i,e=>{j(e.docs.map(e=>{let t=e.data();return{id:e.id,dateId:t.dateId,text:t.text,createdAt:t.createdAt}})),v(!1)},e=>{S(e?.message||"Fragmentsの取得に失敗しました"),v(!1)});return()=>r()},[e,k]),(0,i.useEffect)(()=>{if(!e||!k){T(null),D([]),A(!1);return}A(!0),C("");let t=(0,s.collection)(o.db,`users/${e}/dayDiaries/${k}/versions`),i=(0,s.query)(t,(0,s.orderBy)("generatedAt","desc")),r=(0,s.onSnapshot)(i,e=>{let t=e.docs.map(e=>{let t=e.data();return{id:e.id,dateId:t.dateId,text:t.text,generatedAt:t.generatedAt,stats:t.stats}});D(t),T(t[0]??null),A(!1)},e=>{C(e?.message||"Versionsの取得に失敗しました"),A(!1)});return()=>r()},[e,k]);let B=(0,i.useMemo)(()=>!!e&&!!k&&y.length>0&&!R,[e,k,y.length,R]);async function Y(){if(M(""),B){N(!0);try{await p(k)}catch(e){console.error("callGenerateDayDiary error",e),console.error("code",e?.code,"message",e?.message,"details",e?.details),M(e?.message||"生成に失敗しました。もう一度お試しください。")}finally{N(!1)}}}let F=w?x(w.generatedAt):null,E=w?.stats?.fragmentCount??null;return(0,t.jsxs)("div",{className:"mlm-page",children:[(0,t.jsx)("header",{className:"mlm-homeHeader",children:(0,t.jsx)("div",{className:"mlm-homeHeaderRow",children:(0,t.jsxs)("div",{className:"mlm-homeTitle",children:[(0,t.jsx)("div",{className:"mlm-avatar"}),(0,t.jsx)("div",{className:"mlm-titleText",children:"私の日記記録"})]})})}),(0,t.jsx)("main",{className:"mlm-pageBody",children:(0,t.jsx)("div",{className:"mlm-container",children:(0,t.jsx)("div",{className:"mlm-card mlm-panel",children:(0,t.jsxs)("div",{style:{marginTop:16,display:"grid",gap:12},children:[(0,t.jsx)(r.default,{children:(0,t.jsx)("div",{style:{display:"grid",gap:10},children:(0,t.jsx)(a.default,{label:"dateId(YYYY-MM-DD)",children:(0,t.jsx)("input",{value:h,onChange:e=>m(e.target.value),style:{width:"100%",padding:10,borderRadius:10,border:"1px solid rgba(0,0,0,0.18)"}})})})}),(0,t.jsxs)(r.default,{children:[(0,t.jsx)(d,{title:"生成結果(最新)",subtitle:w?`${F?u(F):"時刻不明"} / fragmentCount:${E??"?"}`:"まだ生成されていません"}),(0,t.jsxs)("div",{style:{marginTop:12},children:[$?(0,t.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,t.jsx)(n,{height:14}),(0,t.jsx)(n,{height:14}),(0,t.jsx)(n,{height:14}),(0,t.jsx)(n,{height:14})]}):w?(0,t.jsx)("div",{style:{whiteSpace:"pre-wrap",lineHeight:1.75},children:w.text}):f?(0,t.jsx)(l.default,{title:"読み込み中",description:"Fragmentsを読み込んでいます"}):0===y.length?(0,t.jsx)(l.default,{title:"材料がありません",description:"まずはwriteで断片を追加してください"}):(0,t.jsx)(l.default,{title:"未生成",description:"材料が揃ったら下のボタンで生成できます"}),z?(0,t.jsx)("div",{style:{marginTop:10,color:"crimson",fontSize:12},children:z}):null]}),(0,t.jsxs)("div",{style:{marginTop:14,display:"flex",alignItems:"center",gap:10},children:[(0,t.jsx)("button",{onClick:Y,disabled:!B,style:{padding:"10px 14px",borderRadius:12,border:"1px solid rgba(0,0,0,0.18)",background:B?"black":"rgba(0,0,0,0.06)",color:B?"white":"rgba(0,0,0,0.55)",cursor:B?"pointer":"not-allowed"},children:"日記を生成/更新"}),(0,t.jsx)("div",{style:{fontSize:12,opacity:.8},children:R?"生成中…":""})]}),H?(0,t.jsx)("div",{style:{marginTop:10,color:"crimson",fontSize:12},children:H}):null]}),(0,t.jsxs)(r.default,{children:[(0,t.jsx)(d,{title:"素材パック(Fragments)",subtitle:k?`dateId:${k}`:"dateIdが不正です"}),(0,t.jsx)("div",{style:{marginTop:12},children:f?(0,t.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,t.jsx)(n,{height:14}),(0,t.jsx)(n,{height:14}),(0,t.jsx)(n,{height:14})]}):b?(0,t.jsx)("div",{style:{color:"crimson",fontSize:12},children:b}):0===y.length?(0,t.jsx)(l.default,{title:"0件",description:"writeで断片を追加してください"}):(0,t.jsx)("div",{style:{display:"grid",gap:10},children:y.map(e=>{let i=x(e.createdAt);return(0,t.jsxs)("div",{style:{padding:12,borderRadius:14,border:"1px solid rgba(0,0,0,0.12)"},children:[(0,t.jsx)("div",{style:{fontSize:12,opacity:.7},children:i?u(i):"時刻未確定"}),(0,t.jsx)("div",{style:{marginTop:6,whiteSpace:"pre-wrap",lineHeight:1.65},children:e.text})]},e.id)})})})]}),(0,t.jsxs)(r.default,{children:[(0,t.jsx)(d,{title:"過去の生成履歴",subtitle:"generatedAt降順"}),(0,t.jsx)("div",{style:{marginTop:12},children:$?(0,t.jsx)(l.default,{title:"読み込み中",description:"少し待ってください"}):0===I.length?(0,t.jsx)(l.default,{title:"履歴なし",description:"生成するとversionsが増えます"}):(0,t.jsx)("div",{style:{display:"grid",gap:10},children:I.map(e=>{let i=x(e.generatedAt),s=`${i?u(i):"時刻不明"} / fragmentCount:${e.stats?.fragmentCount??"?"}`;return(0,t.jsxs)("details",{style:{borderRadius:14,border:"1px solid rgba(0,0,0,0.12)",padding:12},children:[(0,t.jsxs)("summary",{style:{cursor:"pointer"},children:[(0,t.jsx)("span",{style:{fontWeight:700},children:e.id}),(0,t.jsx)("span",{style:{marginLeft:10,fontSize:12,opacity:.75},children:s})]}),(0,t.jsx)("div",{style:{marginTop:10,whiteSpace:"pre-wrap",lineHeight:1.75},children:e.text})]},e.id)})})})]})]})})})})]})}e.s(["default",()=>m],53917)}]);