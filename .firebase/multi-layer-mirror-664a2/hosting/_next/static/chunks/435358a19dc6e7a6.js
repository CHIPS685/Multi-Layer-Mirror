(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,a,t)=>{a.exports=e.r(76562)},31713,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(18566);e.i(51718);var l=e.i(18357),n=e.i(29371),i=e.i(47392);e.i(36180);var d=e.i(98925);async function r(e){let{uid:a,monthId:t}=e,{startDateId:s,endDateId:l}=(0,i.monthRangeDateIds)(t),r={},m=(0,d.collection)(n.db,"users",a,"fragments"),c=(0,d.query)(m,(0,d.where)("dateId",">=",s),(0,d.where)("dateId","<=",l));(await (0,d.getDocs)(c)).forEach(e=>{let a=e.data(),t=a?.dateId;"string"==typeof t&&(r[t]||(r[t]={hasFragments:!1,hasDiary:!1}),r[t].hasFragments=!0)});let h=(0,d.collection)(n.db,"users",a,"dayDiaries"),o=(0,d.query)(h,(0,d.where)((0,d.documentId)(),">=",s),(0,d.where)((0,d.documentId)(),"<=",l));return(await (0,d.getDocs)(o)).forEach(e=>{let a=e.id;r[a]||(r[a]={hasFragments:!1,hasDiary:!1}),r[a].hasDiary=!0}),r}function m(){let e=(0,s.useRouter)(),[d,m]=(0,t.useState)(null),[c,h]=(0,t.useState)(()=>(0,i.monthIdFromDate)(new Date)),[o,u]=(0,t.useState)({}),[x,y]=(0,t.useState)(!0),[j,v]=(0,t.useState)(null),N=(0,t.useMemo)(()=>(0,i.todayDateId)(),[]),f=(0,t.useMemo)(()=>(0,i.buildMonthMatrix)(c),[c]);return(0,t.useEffect)(()=>{let e=!1;return async function(){try{if(n.auth.currentUser){e||m(n.auth.currentUser.uid);return}let a=await (0,l.signInAnonymously)(n.auth);e||m(a.user.uid)}catch(a){console.error(a),e||(v("auth failed"),y(!1))}}(),()=>{e=!0}},[]),(0,t.useEffect)(()=>{let e=!1;return async function(){if(d){y(!0),v(null);try{let a=await r({uid:d,monthId:c});if(e)return;u(a),y(!1)}catch(a){if(console.error(a),e)return;v("load failed"),y(!1)}}}(),()=>{e=!0}},[d,c]),(0,a.jsxs)("div",{className:"mlm-home",children:[(0,a.jsx)("header",{className:"mlm-homeHeader",children:(0,a.jsx)("div",{className:"mlm-homeHeaderRow",children:(0,a.jsxs)("div",{className:"mlm-homeTitle",children:[(0,a.jsx)("div",{className:"mlm-avatar"}),(0,a.jsx)("div",{className:"mlm-titleText",children:"私の日記記録"})]})})}),(0,a.jsx)("main",{className:"mlm-homeBody",children:(0,a.jsx)("div",{className:"mlm-container",children:(0,a.jsxs)("section",{className:"mlm-card mlm-calendarCard","aria-label":"month calendar",children:[(0,a.jsxs)("div",{className:"mlm-calTop",children:[(0,a.jsxs)("div",{className:"mlm-calTopRow",children:[(0,a.jsx)("div",{className:"mlm-monthLabel",children:function(e){let a=/^(\d{4})-(\d{2})$/.exec(e);if(!a)return e;let t=a[1],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][Math.max(0,Math.min(11,Number(a[2])-1))];return`${s} ${t}`}(c)}),(0,a.jsxs)("div",{className:"mlm-calNav",children:[(0,a.jsx)("button",{className:"mlm-calNavBtn",type:"button",onClick:()=>h(e=>(0,i.shiftMonthId)(e,-1)),children:"◀"}),(0,a.jsx)("button",{className:"mlm-calNavBtn",type:"button",onClick:()=>h((0,i.monthIdFromDate)(new Date)),children:"●"}),(0,a.jsx)("button",{className:"mlm-calNavBtn",type:"button",onClick:()=>h(e=>(0,i.shiftMonthId)(e,1)),children:"▶"})]})]}),(0,a.jsx)("div",{style:{marginTop:10,display:"flex",justifyContent:"flex-end"},children:(0,a.jsx)("div",{className:"mlm-chip",children:"3日達成"})}),(0,a.jsxs)("div",{className:"mlm-dow",children:[(0,a.jsx)("div",{children:"SUN"}),(0,a.jsx)("div",{children:"MON"}),(0,a.jsx)("div",{children:"TUE"}),(0,a.jsx)("div",{children:"WED"}),(0,a.jsx)("div",{children:"THU"}),(0,a.jsx)("div",{children:"FRI"}),(0,a.jsx)("div",{children:"SAT"})]}),(0,a.jsx)("div",{className:"mlm-calGrid",children:f.map((t,s)=>(0,a.jsx)("div",{className:"mlm-calRow",children:t.map(t=>{let s=o[t.dateId]??{hasFragments:!1,hasDiary:!1},l=t.dateId===N,n="mlm-dayBtn "+(t.inMonth?"mlm-dayInMonth ":"mlm-dayOutMonth ")+(l?"mlm-dayToday":"mlm-dayNormal");return(0,a.jsxs)("button",{className:n,type:"button",onClick:()=>e.push(`/day?dateId=${t.dateId}`),title:t.dateId,"aria-label":`open ${t.dateId}`,children:[String(Number(t.dateId.slice(8,10))),(s.hasFragments||s.hasDiary)&&(0,a.jsxs)("div",{className:"mlm-mark",children:[s.hasFragments?(0,a.jsx)("span",{title:"has fragments",children:"●"}):null,s.hasDiary?(0,a.jsx)("span",{title:"has diary",children:"✨"}):null]})]},t.dateId)})},s))})]}),(0,a.jsxs)("div",{className:"mlm-calBottom",children:[(0,a.jsx)("button",{className:"mlm-cta",type:"button",onClick:()=>e.push(`/day?dateId=${(0,i.todayDateId)()}`),children:"今日の記録を追加"}),(0,a.jsx)("div",{style:{marginTop:10},children:(0,a.jsx)("button",{className:"mlm-ctaSub",type:"button",onClick:()=>e.push("/write"),children:"破片を書く"})}),x?(0,a.jsx)("div",{className:"mlm-hint",children:"読み込み中…"}):j?(0,a.jsx)("div",{className:"mlm-hint",children:j}):(0,a.jsx)("div",{className:"mlm-hint",children:"日付をタップするとdayに移動する"})]})]})})})]})}e.s(["default",()=>m],31713)}]);